/*		d m a k e f i l e
 * File:
  	dmakefile
 * Function:
  	Drama makefile source for 2DFCANTASK sub system
  
 * Description:
  	The program dmkmf should be run in the directory containing this
  	file to generate a Makefile or descrip.mms file for the desired
  	target

  
 * Author: {author}
 
 *  Copyright (c) Anglo-Australian Telescope Board, 2018.
    Not to be used for commercial purposes without AATB permission.
  

 * "@(#) $Id: ACMM:2dFCanTask/dmakefile,v 1.3 29-Mar-2018 12:49:45+10 ks $"

 * History:
     02-Mar-2018 - KS - Original version
	
			
 */
 
#BeginConfig 
ACMM_RELEASE=1_3$(ACMMBUILDVER)
RELEASE=r$(ACMM_RELEASE)
SYSTEM=2dFCanTask			/* System name (for release	*/
CONFIGURATOR_DIR = ../AAOCANBusIniConfigurator
CML_DIR = ../CANopen_CML
SIM_CAN_OPEN_DIR = ../SimCanOpen
XWING_DIR = ../XWing
TCS_UTIL_DIR = ../TcsUtil
INCLUDES =  -I. DramaIncl IDir(DRAMA2_DIR) -I $(CONFIGURATOR_DIR) -I $(CML_DIR)/inc \
             -I $(SIM_CAN_OPEN_DIR) -I $(XWING_DIR) -I $(TCS_UTIL_DIR)

/*
 * Enable Ansi C++ V11/V14 full warnings.  If we have C++14, then we
 * use it, otherwise we presume we have C++11
 */
#if HasCPlusPlus14
USERCCCOPTIONS = AnsiCC14Full()
#else
USERCCCOPTIONS = AnsiCC11Full()
#endif



#EndConfig
LIBS=LinkLibDir(DRAMA2_LIB,drama2) $(CONFIGURATOR_DIR)/libAAOCANBusConfigurator.a \
          $(CML_DIR)/c/libcml.a $(SIM_CAN_OPEN_DIR)/libSimCanOpen.a \
          $(XWING_DIR)/libXWing.a $(TCS_UTIL_DIR)/libTcsUtil.a

NormalCRules()			/* Include normal c rules	*/
/*
 *	Objects to be put in the 2DFCANTASK library.
 */
OBJECTS = Obj(CanAccess) Obj(2dFCanTask) Obj(2dFCanTask_$(RELEASE))

/*
 *	Sources for makedepend.
 */
SRC1=  2dFCanTask.cpp CanAccess.cpp

/*
 * The target All will build the 2DFCANTASK library and program.
 */
DummyTarget(All,  NotVms(checktarget) includes Lib(2dFCanTask) Exe(2dFCanTask))

DramaCheckTarget()

/*
 * We use an includes target for include files which need to be built.  This
 * is only realy necessary if makedepnds has not been run.
 */
DummyTarget(includes, 2dFCanTask_err.h 2dFCanTask_err_msgt.h)
/*
* Generate the error code include file.
 */
ErrorIncludeFiles(2dFCanTask_err)

2dFCanTask_$(RELEASE).o : 2dFCanTaskversion.c
	@ echo Compiling 2dFCanTaskversion to $@
	$(CC) -c $(CFLAGS) StringDefine(TDFCANTASK_VER,$(RELEASE)) -DTDFCANTASK_DATE=$(DATE_CMD) 2dFCanTaskversion.c
	mv 2dFCanTaskversion.o $@

CanAccess.o : CanAccess.cpp CanAccess.h

/*
 * The 2DFCANTASK object library
 */
ObjectLibraryTarget(2dFCanTask, $(OBJECTS),)


/*
 * The 2DFCANTASK program itself
 */
DramaCPPProgramTarget(2dFCanTask, Obj(2dFCanTask) Obj(CanAccess), Lib(2dFCanTask), $(LIBS),)

/*
 * Release targets
 */
DramaReleaseCheck()
DramaReleaseCommon(2dFCanTask_err.h 2dFCanTask_err_msgt.h 2dFCanTask.h)
DramaReleaseTarget(2dFCanTask,Lib(2dFCanTask),,))
DramaReleaseDramaStart()

/*
 * Target to enableGIT.
 */
DramaEnable()
DramaDirs()

